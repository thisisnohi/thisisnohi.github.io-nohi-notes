(window.webpackJsonp=window.webpackJsonp||[]).push([[70],{286:function(t,s,n){"use strict";n.r(s);var a=n(5),o=Object(a.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"content"},[n("h2",{attrs:{id:"springcloud-feign"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#springcloud-feign","aria-hidden":"true"}},[t._v("#")]),t._v(" SpringCloud Feign")]),t._v(" "),n("blockquote",[n("p",[t._v("create by nohi 20191121")])]),t._v(" "),n("h2",{attrs:{id:"超时时间设置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#超时时间设置","aria-hidden":"true"}},[t._v("#")]),t._v(" 超时时间设置")]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{attrs:{class:"token number"}},[t._v("1.")]),t._v("把超时发生异常属性关闭 "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("测试后发现，超过"),n("span",{attrs:{class:"token number"}},[t._v("60")]),t._v("s后仍超时"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nhystrix"),n("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v("\n  command"),n("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v("\n      "),n("span",{attrs:{class:"token keyword"}},[t._v("default")]),n("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v("\n        execution"),n("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v("\n          timeout"),n("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v("\n            enabled"),n("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n"),n("span",{attrs:{class:"token number"}},[t._v("2.")]),t._v("同样出现超过"),n("span",{attrs:{class:"token number"}},[t._v("60")]),t._v("秒超时总是\nhystrix"),n("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v("\n  command"),n("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    "),n("span",{attrs:{class:"token string"}},[t._v('"MyFeignClient#sayWhyByFeign()"')]),n("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v("\n      execution"),n("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v("\n        isolation"),n("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v("\n          thread"),n("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v("\n            timeoutInMilliseconds"),n("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token number"}},[t._v("9000")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("default")]),n("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v("\n      execution"),n("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v("\n        isolation"),n("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v("\n          thread"),n("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v("\n            timeoutInMilliseconds"),n("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token number"}},[t._v("2000")]),t._v("\n\nribbon"),n("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v("\n  ReadTimeout"),n("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token number"}},[t._v("5000")]),t._v("\n  ConnectTimeout"),n("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token number"}},[t._v("5000")]),t._v("\n\n"),n("span",{attrs:{class:"token number"}},[t._v("3.")]),t._v(" configu设置超时\n    "),n("span",{attrs:{class:"token annotation punctuation"}},[t._v("@Bean")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" Feign"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Builder "),n("span",{attrs:{class:"token function"}},[t._v("feignHystrixBuilder")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" HystrixFeign"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("builder")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("setterFactory")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{attrs:{class:"token class-name"}},[t._v("SetterFactory")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" HystrixCommand"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Setter "),n("span",{attrs:{class:"token function"}},[t._v("create")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Target"),n("span",{attrs:{class:"token operator"}},[t._v("<")]),n("span",{attrs:{class:"token operator"}},[t._v("?")]),n("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" target"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Method method"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                String groupKey "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" target"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("name")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),n("span",{attrs:{class:"token comment"}},[t._v('//@FeignClient(name = "xxx-im"')]),t._v("\n                System"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("println")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("groupKey"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                String commandKey "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" method"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("getName")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                System"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("println")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v('"commandKey=="')]),n("span",{attrs:{class:"token operator"}},[t._v("+")]),t._v("commandKey"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n                "),n("span",{attrs:{class:"token comment"}},[t._v("//打印,为每一个方法生成一个对象，此时groupKey，commandKey没用，可以设置超时时间")]),t._v("\n                "),n("span",{attrs:{class:"token comment"}},[t._v("/**\n                 * xxx-im2\n                 commandKey==queryCategoriesCodeByProductCode2\n                 xxx-im2\n                 commandKey==queryCategoriesCodeByProductCode\n                 xxx-im2\n                 commandKey==queryMaxBasicPriceByPizzaSizeCode\n                 */")]),t._v("\n                "),n("span",{attrs:{class:"token keyword"}},[t._v("int")]),t._v(" time "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token number"}},[t._v("120000")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v('"queryCategoriesCodeByProductCode2"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("equals")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("commandKey"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    time "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token number"}},[t._v("4000")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n                "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" HystrixCommand"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Setter\n                        "),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("withGroupKey")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("HystrixCommandGroupKey"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Factory"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("asKey")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("groupKey"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token comment"}},[t._v("// 控制 RemoteProductService 下,所有方法的Hystrix Configuration")]),t._v("\n                        "),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("andCommandKey")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("HystrixCommandKey"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Factory"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("asKey")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("commandKey"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                        "),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("andCommandPropertiesDefaults")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n                                HystrixCommandProperties"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("Setter")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("withExecutionTimeoutInMilliseconds")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("time"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token comment"}},[t._v("// 超时配置")]),t._v("\n                        "),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    \n")])])])])}],!1,null,null,null);s.default=o.exports}}]);